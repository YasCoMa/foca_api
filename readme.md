# FOCA-API

API written in Python-Flask to retrieve processed data from the samples metadata exported by [GISAID](https://gisaid.org/)

## Summary
This repository contains (i) the script to preprocess, clean and summarize samples metadata from GISAID; (ii) An api script to serve the requests to get the json files corresponding to the summarization made in preprocessing step, as well as the requests to perform Spike protein structural comparison analysis; and (iii) the instructions to run only the structural comparison pipeline alone. This pipeline has three main modules: (i) Generate the nwew mutated Spike structure using [FoldX](https://foldxsuite.crg.eu/academic-license-info); (ii) Compare the druggable binding sites according to the [FPocket](https://github.com/Discngine/fpocket) analysis and (iii) Compare features from the secondary structure prediction (surface accessible area, hydrophobic sites, etc), using the [PredictProperty](https://github.com/realbigws/Predict_Property) tool.

## Requirements:
* In the auxiliar_functions.py and api.py scripts, change the content of the variable directory to the path in your computer to this repository.

## Usage Instructions
The steps below contain instructions to update the data with new gisaid metadata, to run the structural pipeline. <br ><br>
* Prepare environment and dependencies:
    1. conda env create -f foca_backend.yml
	2. conda activate foca
	3. Uncompress structural_effects/pipeline_strucomparison/foldx/foldx.tar.xz
	
* GISAID Data Preparation:
	1. ````git clone https://github.com/YasCoMa/foca_api.git````
	2. ````cd foca_api````
	3. Put the metadata file_exported by GISAID in the data/ folder using the name metadata.tsv
	4. The file ````generate_processed_data```` contains functions to clean, extract and summarize the correlations among the columns
	5. In the run method there are the calls for all available methods, uncomment those you want to test or update with your data.
	6. ````python3 generate_processed_data.py```` 
	7. All the preprocessed files generated by this script will appear in data/ folder

* Running the API:
	1. ````python3 api.py```` 

* Running the Structural Comparison pipeline (separately):
	1. ````cd structural_effects/pipeline_strucomparison/```` 
	2. Run this to see the help menu: ````python3 pipeline.py --help ```` 
	3. Run all steps: ````python3 pipeline.py -rt 0 -fo "data_folder/" -rp spike_ref.pdb -rf spike.fasta -lm mutations_file.txt -pr "structural_analysis" ```` 
	4. Run only mutated structure prediction: ````python3 pipeline.py -rt 1 -fo "data_folder/" -rp spike_ref.pdb -rf spike.fasta -lm mutations_file.txt -pr "structural_analysis" ```` 
	5. Run only binding site prediction and comparison: ````python3 pipeline.py -rt 2 -fo "data_folder/" -rp spike_ref.pdb  ```` 
	6. Run only secondary structure features comparison: ````python3 pipeline.py -rt 3 -fo "data_folder/" -rp spike_ref.pdb -rf spike.fasta -lm mutations_file.txt ```` 
	
### Exporting conda environment dependencies
conda env export > foca_backend.yml

